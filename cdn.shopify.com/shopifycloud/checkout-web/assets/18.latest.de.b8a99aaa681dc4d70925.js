"use strict";(self.webpackChunkcheckout_web=self.webpackChunkcheckout_web||[]).push([[18],{9205:(e,t,n)=>{n.d(t,{A:()=>g});var o=n(17402),r=n(32485),i=n.n(r),a=n(50190),s=n(39629),c=n(39122),l=n(15694),d=n(47862),u=n(17141);const p=10;const m={Popper:"Pf2ss"};function f({children:e,offset:t,arrowOffset:n,contentWidth:r,contentHeight:i,placement:a="inlineEnd",activator:s,open:c}){const l=function(e){const[t,n]=(0,o.J0)(null),r=(0,o.hb)((()=>{null!==e&&n(e.getBoundingClientRect())}),[e]);return(0,o.Nf)((()=>(r(),window.addEventListener("resize",r),window.addEventListener("scroll",r),()=>{window.removeEventListener("resize",r),window.removeEventListener("scroll",r)})),[r]),t}(s??null),[d,f]=function(){const[e,t]=(0,o.J0)(null);return[e,(0,o.hb)((e=>{null!==e&&t(e.getBoundingClientRect())}),[])]}(),{offsets:h,spacing:v}=(0,o.Kr)((()=>c?function(e,t,n,o,{offset:r=0,arrowOffset:i=0}={}){let a={x:0,y:0},s={left:0,right:0},c=0;if(!t&&!n)return{offsets:a,spacing:c};if(!o){const{clientWidth:e,clientHeight:o}=document.documentElement;return a={x:e/2-t/2,y:o/2-n/2},{offsets:a,spacing:c}}switch(e){case"blockEnd":a={x:"rtl"===(document?.dir??"ltr")?o.left:o.right-t,y:o.bottom+r};break;case"inlineEnd":a={x:"rtl"===(document?.dir??"ltr")?o.left-t-r:o.right+r,y:o.top+o.height/2-i}}return s=function(e,t){const n=document.documentElement.clientWidth,o=e.x+t;let r={left:0,right:0};return o>n&&(r={...r,right:n-o}),e.x<0&&(r={...r,left:-e.x}),r}(a,t),s.right&&!s.left?(a.x+=s.right,c=-p):!s.right&&s.left&&(a.x=0,c=p),{offsets:a,spacing:c}}(a,(r||d?.width)??0,(i||d?.height)??0,l,{offset:t,arrowOffset:n}):{offsets:{x:0,y:0},spacing:0}),[t,n,a,d,l,c,r,i]),{x:g,y:y}=(0,o.Kr)((()=>c?function({x:e,y:t}){const n=window.devicePixelRatio||1;return{x:Math.round(e*n)/n||0,y:Math.round(t*n)/n||0}}({x:h.x+v+(window.scrollX||window.pageXOffset),y:h.y+(window.scrollY||window.pageYOffset)}):{x:0,y:0}),[h,v,c]),w=(0,o.Kr)((()=>c?(window.devicePixelRatio||1)<2?`translate(${g}px, ${y}px)`:`translate3d(${g}px, ${y}px, 0)`:"none"),[c,g,y]);return o.Ay.createElement(u.Z,null,o.Ay.createElement("div",{className:m.Popper,style:{...d&&{transform:w,MozTransform:w,WebkitTransform:w}},ref:f,"aria-hidden":!c},e))}const h={Backdrop:"xMIj4","Backdrop-visible":"VLxei",BackdropLinearGradient:"HL3Ni",Popover:"yw5IT",Content:"sBT8I",PopoverArrow:"tcSqP",PopoverOpen:"cmmgp","Popover-placementInlineEnd":"x9acH","Popover-placementBlockEnd":"mPjCY",Bumper:"bCw1T"},v=(0,s.W)("Popover");function g({children:e,activator:t,open:n,placement:r="inlineEnd",contentWidth:s,contentHeight:u,onClose:p}){const m=(0,o.li)(null),g=(0,o.li)(null),y=(0,o.li)(null),w=(0,l.B)(void 0,v),k=(0,d.ts)(),S=(0,o.hb)((()=>{"BUTTON"===t?.tagName&&(t?.setAttribute("aria-controls",w),t?.setAttribute("aria-expanded",String(n)))}),[t,n,w]),E=(0,o.hb)((e=>{p?.(e)}),[p]),L=(0,o.hb)((e=>{e.target instanceof Node&&!t?.contains(e.target)&&document.contains(e.target)&&!y.current?.contains(e.target)&&n&&E(e)}),[E,t,n,y]),P=(0,o.hb)((e=>{if(n)switch(e.key){case"Escape":case"Esc":E(),t?.focus()}}),[E,t,n]);(0,o.vJ)((()=>(document.addEventListener("click",L),()=>{document.removeEventListener("click",L)})),[L]),(0,o.vJ)((()=>(n&&document.addEventListener("keydown",P,!1),()=>{document.removeEventListener("keydown",P,!1)})),[n,P]),(0,o.vJ)((()=>{S()})),(0,o.Nf)((()=>{n&&y.current?.focus({preventScroll:!0})}),[n]);const _=e=>{const t=y.current;if(t){const n=e?(0,c.ag)(t):(0,c.KB)(t);n?n.focus():t.focus()}},b=i()(h.Popover,h[(0,a.N)("Popover-placement",r)],n&&h.PopoverOpen,t&&h.PopoverArrow);return o.Ay.createElement(o.Ay.Fragment,null,o.Ay.createElement(f,{activator:t,placement:r,offset:15,arrowOffset:30,open:n,contentWidth:s,contentHeight:u},n&&o.Ay.createElement("button",{className:h.Bumper,ref:m,"aria-hidden":"true",onFocus:()=>_(!1)}),o.Ay.createElement("div",{className:b,id:w,ref:y},o.Ay.createElement("div",{className:h.Content},e)),n&&o.Ay.createElement("button",{className:h.Bumper,ref:g,"aria-hidden":"true",onFocus:()=>_(!0)})),o.Ay.createElement("div",{className:i()(h.Backdrop,n&&h["Backdrop-visible"],n&&k&&h.BackdropLinearGradient)}))}},37018:(e,t,n)=>{n.r(t),n.d(t,{default:()=>le});var o=n(17402),r=n(46845),i=n(18905),a=n(47472),s=n(56784),c=n(66126),l=n(63292),d=n(89557),u=n(87455),p=n(17028),m=n(74296);let f=function(e){return e.Control="control",e.ShopJsVerificationModal="shop-js",e}({});const h=f.Control;f.ShopJsVerificationModal;var v=n(18751),g=n(89983),y=n(35699),w=n(37981),k=n(76882),S=n(94973),E=n(34839),L=n(41889),P=n(9210),_=n(28540),b=n(38909),N=n(99548),C=n(27767),$=n(6211),x=n(54493),A=n(7395),J=n(24123),I=n(9205),T=n(54986),B=n(71693),V=n(46792);var M=n(41004),R=n(41813),O=n(29845),K=n(76386),D=n(61022),W=n(58389),H=n(69618);class F extends Error{constructor(...e){super(...e),this.name="ShopPayError"}}function j({email:e,skipVerifyOnLoad:t,iframeReady:n,iframeRef:r,dismissedModalKey:i,readyToDismiss:a,onReadyToDismiss:s,showPopover:c,showToggle:d,popoverActivator:u}){const p=(0,l.rZ)(),[m]=(0,R.c5)(),{guestDismissedModalKey:f}=(0,O.N)(),{checkoutSessionIdentifier:h}=(0,E.Fo)(),[,g]=(0,S.fp)(J.N),y=(0,S.QN)(),w=(0,D.QV)(W.Z.ShopPayVerification,{scope:H.e5});return(0,o.vJ)((()=>{if(t.current&&n)return void(t.current=!1);const o=p&&(0,L.Ri)(i),a=e&&(0,v.B9)(e),s="connected"===m.status,c=p&&function(){const e=sessionStorage.getItem(b.eQ);if(!e)return!1;const t=Number.parseInt(e,10);return!isNaN(t)&&Date.now()<t}();!n||!a||o||s||c||(y.read(w).value!==K.Vp.Verified?(0,B.L)(r?.current,{action:V.L$.Create,email:e,flow:M.n.Normal,disableAutoFocus:Boolean(sessionStorage.getItem(f))}):y.write(w,void 0))}),[e,n]),{onShow:function(){if(!h)throw new F("Checkout token is undefined");p&&(0,L.Ri)(i)||e&&(0,v.B9)(e)&&(a||s(),(0,L.TV)(b.Sl,escape(h)),(0,L.TV)(b.GH,"false"),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set")),y.write(w,K.Vp.Pending),sessionStorage.getItem(f)?d?.(!0):(c(!0,e),d?.(!1)))},onHidden:function(){a&&(y.write(w,K.Vp.Dismissed),p&&(0,L.TV)(i,"true"),u?.current?.focus(),c(!1),d?.(!0))},onLoggedIn:function(){(0,v.NW)(),y.write(w,K.Vp.Verified),g("none")}}}var z=n(12227),U=n(22947),Z=n(49270),G=n(98815),Q=n(7821);class q extends Error{constructor(...e){super(...e),this.name="ShopPayError"}}const X=[V.hD.FraudGuard,V.hD.InvalidPhone,V.hD.LimitExceeded,V.hD.PhoneBlocked];function Y({email:e,onSetEmail:t,skipVerifyOnLoad:n,iframeReady:r,iframeRef:a,readyToDismiss:s,onReadyToDismiss:c,showPopover:l,popoverActivator:d,origin:u,open:p}){const{checkoutSessionIdentifier:m}=(0,E.Fo)(),{openModal:f}=(0,z.$)(),{exchangeSessionTokenForCookie:h}=(0,U.H)(),[,g]=(0,S.fp)(J.N),y=(0,o.li)(null),w=(0,o.li)(!1),k=(0,Z.oO)(),[,L]=(0,G.j1)(),P=(0,o.hb)((()=>{a.current&&(0,B.L)(a.current,{action:V.L$.Create,email:"",flow:M.n.Normal})}),[a]);return(0,o.vJ)((()=>{a.current&&r&&u===i.K.C1ModalShopPaySignIn&&((0,B.L)(a.current,{action:V.L$.AllowNoInitialEmail}),P(),(0,B.L)(a.current,{action:V.L$.Ready}))}),[r,a,u,P]),(0,o.vJ)((()=>{p&&(y.current=null)}),[p]),(0,o.vJ)((()=>{w.current&&a.current&&r&&(w.current=!1,P())})),(0,o.vJ)((()=>{function e(){t&&(k.set({email:"",userStatus:Z.$_.None}),t(""),d?.current?.focus()),w.current=!0}return window.addEventListener("shop_pay_verification_reset",e),()=>{window.removeEventListener("shop_pay_verification_reset",e)}}),[d,l,t,a,k]),(0,o.vJ)((()=>{r&&(n.current?n.current=!1:e&&(0,v.B9)(e)&&u!==i.K.C1ModalShopPaySignIn?(k.set({email:e,userStatus:Z.$_.Loading}),(0,B.L)(a?.current,{action:V.L$.Create,email:e,flow:M.n.Normal})):u!==i.K.C1ModalShopPaySignIn&&(P(),k.set({email:"",userStatus:Z.$_.None})))}),[e,r,n,a,u,k,P,l,L]),{onShow:function(){if(!m)throw new q("Checkout token is undefined");u===i.K.C1ModalShopPay&&e&&(0,v.B9)(e)&&(s||c(),k.set({email:e,userStatus:Z.$_.Found}),l(!0,e))},onHidden:function(){if(u===i.K.C1ModalShopPay&&!s)return;const n=y.current;null!=t&&null!=n&&(n.userStatus!==Z.$_.Found||u===i.K.C1ModalShopPay||!e)&&(t(n.email),k.set(n),d?.current?.focus()),k.get().userStatus===Z.$_.Found?f({type:Q.W.ContinueWithShopPay,email:k.get().email}):d?.current?.focus(),l(!1),y.current=null},onEmailChange:function(e,t){e?(y.current||k.get().email!==e)&&(y.current={email:e,userStatus:t?Z.$_.Found:Z.$_.New}):y.current={email:"",userStatus:Z.$_.None}},onError:function(e,t,n){if((!n||n===k.get().email)&&(e===V.Wu.ShopifyPayUserNotFound&&X.includes(t)&&(l(!1),f({type:Q.W.Generic})),n)){const e=t===V.hD.InvalidEmail;k.set({email:n,userStatus:e?Z.$_.Invalid:Z.$_.New})}},onLoggedIn:async function(e,t){(0,v.NW)(),g("none"),e&&(await h({token:e,origin:u,in_checkout_profile_preview:t}),window.location.reload())}}}var ee=n(94012);function te({email:e,onSetEmail:t,open:n,popoverActivator:r,showPopover:a,showToggle:s,urlOrigin:c=i.K.C1Modal,updatedOrigin:l=c,onIframeLoaded:d}){const u=(0,w.t)({base:"blockEnd",medium:"inlineEnd"}),[p,m]=(0,o.J0)(!1),[f,h]=(0,o.J0)(300),[v,y]=(0,o.J0)(!1),M=(0,k.W)(),{checkoutSessionIdentifier:R}=(0,E.Fo)(),O=(0,o.li)(null),{alternate:K}=(0,$.ft)(),D=K,[W,H]=(0,o.J0)(!1),[,F]=(0,S.fp)(J.N),z=(0,S.md)(P.D?.flow)===_.p.UnauthenticatedUser,U=(0,C.d7)(e,b.y4),Z=`${R}-${e.replace(/[^a-zA-Z0-9]/g,"")}`,G=(0,N.Q)(),Q=(0,o.li)(G),{onShow:q,onHidden:X,onError:te,onEmailChange:ne,onLoggedIn:oe}=function(e){const t=(0,g.W$)(),n=(0,o.li)(e),r=n.current,i=e===n.current?void 0:`Callback hook changed from ${n.current.name} to ${e.name} between renders.`;return(0,o.vJ)((()=>{i&&t.notify(new ee.BS(`${i} Only the original hook is called.`),{severity:"warning",errorClass:"ShopPay::ShopPayVerification::useStableHook"})}),[i,t]),r}(z?Y:j)({email:U,onSetEmail:t,skipVerifyOnLoad:Q,iframeReady:p,iframeRef:O,dismissedModalKey:Z,readyToDismiss:v,onReadyToDismiss:()=>{setTimeout((()=>y(!0)),1e3)},showPopover:a,showToggle:s,popoverActivator:r,origin:l,open:n});(0,T.d)({hostname:D,targetId:c,onReady:q,onClosed:function(){H(!0)},onLoggedIn:oe,onHidden:X,onError:function(e,t,n){te?.(e,t,n),e===V.Wu.ShopifyPayUserNotFound&&(0,L.TV)(b.Sl,"false"),(0,L.TV)(b.GH,t===V.hD.LimitExceeded?R||"":"false"),window.dispatchEvent(new Event("shop_pay_user_identified_cookie_set"))},onResized:function(e){!isNaN(e)&&e&&h(e)},onLoaded:()=>{m(!0),d()},onEmailChange:ne}),(0,o.vJ)((()=>{(0,B.L)(O?.current,{action:V.L$.OriginChanged,origin:l})}),[l]),(0,o.vJ)((()=>{const e=n?V.L$.Ready:V.L$.Hidden;(0,B.L)(O?.current,{action:e}),F(n?"shopPayVerification":"none"),O.current&&n&&O.current.focus()}),[n,F]);const re=(0,A.X)(c);return(0,o.vJ)((()=>()=>{m(!1)}),[re]),re?o.Ay.createElement(I.A,{activator:r?.current??void 0,open:n,onClose:X,placement:u,contentWidth:320,contentHeight:f},o.Ay.createElement(x.R,{active:W||!p,size:"large"},o.Ay.createElement("iframe",{key:re,id:"shop-pay-verification-iframe",title:M("shop_pay.verification.title","Schneller Checkout mit Shop Pay"),ref:O,src:re,height:f,width:320,className:"hRbIp",allow:"publickey-credentials-get *",referrerPolicy:"origin"}))):null}var ne=n(61086),oe=n(50996),re=n(65442),ie=n(25082);const ae=({shopLoginButton:e,eventName:t,eventListener:n})=>{(0,o.vJ)((()=>(e?.addEventListener(t,n),()=>e?.removeEventListener(t,n))),[n,t,e])};function se({email:e,open:t,popoverActivator:n,showPopover:r,showToggle:i,onIframeLoaded:a}){const s=(0,o.Kr)((()=>(0,$.C4)()),[]),c=n?.current,d=c?.id?`#${c.id}`:"",u=(0,o.li)(null),p=(0,o.li)(!1),m=(0,g.W$)(),[f,h]=(0,o.J0)(void 0),v=(0,re.W)(b.C8.ShopPayVerificationModal),{transaction_params:y}=(0,ie.I)(),{myshopifyDomain:w}=(0,oe.q)(),{checkoutSessionIdentifier:k}=(0,E.Fo)(),S=(0,l.rZ)(),[P]=(0,R.c5)(),_=`${k}-${e.replace(/[^a-zA-Z0-9]/g,"")}`,C=(0,N.Q)();(0,o.vJ)((()=>{const t=S&&(0,L.Ri)(_),n="connected"===P.status;t||n||!f&&(c||e&&!C)&&(h("in-progress"),async function(){try{await(0,ne.k)(s,void 0,!0),h("done")}catch(e){m.notify(new ce(`Error loading Shop JS for Verification Modal. Details: ${e}`))}}())}),[S,_,e,c,m,P.status,f,s,C]);const x=(0,o.hb)((()=>{p.current=!0,window.location.assign(v)}),[v]);ae({shopLoginButton:u.current,eventName:"completed",eventListener:x});const A=(0,o.hb)((()=>{r?.(!0,c?.value)}),[c?.value,r]);ae({shopLoginButton:u.current,eventName:"modalopened",eventListener:A});const J=(0,o.hb)((()=>{S&&(0,L.TV)(_,"true"),r?.(!1),i?.(!p.current)}),[S,_,r,i]);ae({shopLoginButton:u.current,eventName:"modalclosed",eventListener:J});const I=(0,o.hb)((()=>{}),[]);return ae({shopLoginButton:u.current,eventName:"error",eventListener:I}),ae({shopLoginButton:u.current,eventName:"iframeloaded",eventListener:a}),(0,o.vJ)((()=>{const e=u.current;c&&t&&e?.requestShow(c.value)}),[c,t]),o.Ay.createElement("shop-login-button",{action:"default","analytics-context":"loginWithShopCheckoutModal","anchor-to":d,"disable-sign-up":!0,email:e,"hide-button":!0,"avoid-sdk-session":!0,ref:u,version:"2","response-type":"code","redirect-type":"iframe","checkout-version":"checkout_one","checkout-token":k,"transaction-params":y,"shop-permanent-domain":w,compact:!0})}class ce extends Error{constructor(...e){super(...e),this.name="ShopJSLoadError"}}const le=({email:e,onSetEmail:t,open:n,popoverActivator:w,showPopover:k,showToggle:S,urlOrigin:E=i.K.C1Modal,updatedOrigin:L=i.K.C1Modal})=>{const P=function(){const e=function(){const{value:e}=(0,l.mu)(),t=!(0,u.o)(),n=Boolean(e?.some((e=>"wallet"===e.type&&e.name===d.R.ShopPay))),o=(0,s.a)(c.hZ)&&n&&t,r=(0,a.K)(p.V_)?.find((e=>e.clientHandle===p.Rv)),i=r?.variant?r.variant:null;return(0,m.H)({disabled:!o,key:"shopjs_verification_modal_variant",variants:Object.values(f)})||(t&&o&&i?i:h)}();return Boolean(e===f.ShopJsVerificationModal)}(),_=(0,u.o)(),b=P&&!_,N=(0,g.SU)(),C=(0,o.Kr)((()=>(0,r.S)()),[]),$=(0,o.Kr)((()=>(0,r.S)()),[]),x=(0,o.li)(!0),A=(0,o.Kr)((()=>{if(void 0!==b)return{isC1:!0,shopJsVerification:b}}),[b]);(0,o.vJ)((()=>{(0,v.B9)(e)&&(C.mark("start"),x.current=!0)}),[C,e]),(0,o.vJ)((()=>{if(n&&x.current&&C.marks.start&&A){C.mark("open"),x.current=!1;const e=Math.round(C.marks.open-C.marks.start);N.distribution(y.J.ShopPayVerificationTimeToInteractive,{value:e,tags:A});const t=Math.round(C.marks.open-Math.max(C.marks.start,C.marks.loaded||0));N.distribution(y.J.ShopPayVerificationTimeToInteractiveAfterLoad,{value:t,tags:A})}}),[n,N,C,A]),(0,o.vJ)((()=>{$.mark("start")}),[$]);const J=(0,o.hb)((()=>{if($.marks.start){$.mark("loaded"),C.mark("loaded");const e=Math.round($.marks.loaded-$.marks.start);N.distribution(y.J.ShopPayVerificationIframeReadyDuration,{value:e,tags:A})}}),[$,C,N,A]);return b?o.Ay.createElement(se,{popoverActivator:w,email:e,open:n,showPopover:k,showToggle:S,onIframeLoaded:J}):o.Ay.createElement(te,{popoverActivator:w,email:e,onSetEmail:t,open:n,showPopover:k,showToggle:S,urlOrigin:E,updatedOrigin:L,onIframeLoaded:J})}},22947:(e,t,n)=>{n.d(t,{H:()=>c});var o=n(17402),r=n(6211),i=n(50996),a=n(34839),s=n(52027);const c=()=>{const{myshopifyDomain:e}=(0,i.q)(),{checkoutSessionIdentifier:t}=(0,a.Fo)(),n=(0,s.j9)();return{exchangeSessionTokenForCookie:(0,o.hb)((async({token:o,origin:i,analytics_trace_id:a,in_checkout_profile_preview:s})=>{const{primary:c}=(0,r.af)(),l=new URLSearchParams({token:o,origin:i,shopify_domain:e});t&&l.set("checkout_token",t),a&&l.set("analytics_trace_id",a),s&&l.set("in_checkout_profile_preview",s),await fetch(`https://${c}${n.shopPaySession()}?${l.toString()}`,{method:"POST",keepalive:!0})}),[t,e,n])}}}}]);